<ion-header [translucent]="true">
    <ion-toolbar color="primary">

        <ion-buttons slot="start">
            <!-- Botón para ir al mes anterior -->

            <ion-button (click)="jornadaService.goToPreviousMonth()">
                <span>Anterior</span>
            </ion-button>
        </ion-buttons>

        <!-- Título con el mes y año actual -->
        <ion-title class="ion-text-center font-bold">
            {{ jornadaService.getCurrentMonthName() | titlecase }} {{ jornadaService.currentMonth().getFullYear() }}
        </ion-title>

        <ion-buttons slot="end">
            <!-- Botón para ir al mes siguiente -->
            <ion-button (click)="jornadaService.goToNextMonth()">
                <span>Siguiente</span>
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
    <span (click)="goToHome()">Ir a la home</span>
    <ion-card class="legend">
        <ion-card-header>
            <ion-card-title>Leyenda</ion-card-title>
        </ion-card-header>
        <ion-card-content>
            <ion-grid>
                <ion-row>
                    <!-- Leyenda actualizada -->
                    <ion-col size="6"><span class="legend-dot day-worked"></span>Día Trabajado</ion-col>
                    <ion-col size="6"><span class="legend-dot day-weekend-worked"></span>Finde Trabajado</ion-col>
                    <ion-col size="6"><span class="legend-dot day-holiday-worked"></span>Festivo Trabajado</ion-col>
                    <ion-col size="6"><span class="legend-dot day-normal"></span>Día Normal</ion-col>
                    <ion-col size="6"><span class="legend-dot day-weekend"></span>Finde</ion-col>
                    <ion-col size="6"><span class="legend-dot day-holiday"></span>Festivo</ion-col>
                </ion-row>
            </ion-grid>
        </ion-card-content>
    </ion-card>

    <ion-grid class="calendar-container">
        <!-- Cabecera de días de la semana -->
        <div class="week-header">
            <div>L</div>
            <div>M</div>
            <div>X</div>
            <div>J</div>
            <div>V</div>
            <div class="weekend">S</div>
            <div class="weekend">D</div>
        </div>

        <!-- Cuadrícula del calendario -->
        <div class="calendar-grid">
            <!-- Días vacíos al inicio -->
            <div *ngFor="let emptyDay of jornadaService.monthDays().emptyStartDays"></div>

            <!-- Días del mes -->
            <div *ngFor="let day of jornadaService.monthDays().days" class="calendar-day" [ngClass]="{
             'day-holiday-worked': jornadaService.isDayWorked(day.date) && jornadaService.isHoliday(day.date),
             'day-holiday': !jornadaService.isDayWorked(day.date) && jornadaService.isHoliday(day.date),


             'day-weekend-worked': jornadaService.isDayWorked(day.date) && jornadaService.isWeekend(day.date) && !jornadaService.isHoliday(day.date),
             'day-weekend': !jornadaService.isDayWorked(day.date) && jornadaService.isWeekend(day.date) && !jornadaService.isHoliday(day.date),


             'day-worked': jornadaService.isDayWorked(day.date) && !jornadaService.isWeekend(day.date) && !jornadaService.isHoliday(day.date),

             'day-normal': !jornadaService.isDayWorked(day.date) && !jornadaService.isWeekend(day.date) && !jornadaService.isHoliday(day.date),
  
             'today': jornadaService.isToday(day.date)
           }" (click)="openModal(day.date)">
                {{ day.dayNumber }}
            </div>

            <!-- Días vacíos al final -->
            <div *ngFor="let emptyDay of jornadaService.monthDays().emptyEndDays"></div>
        </div>
    </ion-grid>

    <!-- Modal para registrar jornada -->
    <ion-modal #logInModal [isOpen]="isModalOpen()">
        <ng-template>
            <ion-header>
                <ion-toolbar color="primary">
                    <ion-title>Registrar Jornada</ion-title>
                    <ion-buttons slot="end">
                        <ion-button (click)="closeModal()">Cerrar</ion-button>
                    </ion-buttons>
                </ion-toolbar>
            </ion-header>
            <ion-content class="ion-padding">
                <div *ngIf="logInModalData() as data">
                    <h2 class="ion-text-wrap">
                        Día: {{ data.date | date:'fullDate' }}
                    </h2>

                    <ion-item>
                        <ion-toggle justify="space-between" [(ngModel)]="data.worked" (ionChange)="onWorkedToggleChange(data.worked)">
                            Trabajado
                        </ion-toggle>
                    </ion-item>

                    <div *ngIf="data.worked">
                        <ion-list>
                            <ion-list-header>Centro de Trabajo</ion-list-header>
                            <ion-row>
                                <ion-col size="6" *ngFor="let center of jornadaService.frequentCenters">
                                    <ion-button [fill]="data.center === center ? 'solid' : 'outline'" color="tertiary" size="small" expand="block" (click)="data.center = center">
                                        {{ center }}
                                    </ion-button>
                                </ion-col>
                            </ion-row>
                            <ion-item>
                                <ion-input label="Otro centro" label-placement="floating" [(ngModel)]="data.center"></ion-input>
                            </ion-item>
                        </ion-list>
                    </div>

                    <ion-button expand="block" color="primary" (click)="saveLog()" class="ion-margin-top">
                        Guardar
                    </ion-button>
                </div>
            </ion-content>
        </ng-template>
    </ion-modal>
</ion-content>